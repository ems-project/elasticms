{
    "body": "{% extends '@EMSCH/template/variables.twig' %}\n\n{% block dom %}\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<?xml-stylesheet type=\"text/xsl\" href=\"{{ asset('other/xsl/sitemap.xsl', 'emsch') }}\"?>\n<urlset xmlns=\"http://www.sitemaps.org/schemas/sitemap/0.9\" xmlns:xhtml=\"http://www.w3.org/1999/xhtml\">\n{#    <sitemap>#}\n{#        <loc>{{ path('sitemap.xml') }}</loc>#}\n{#        <lastmod>{{ 'now'|date('Y-m-d') }}</lastmod>#}\n{#    </sitemap>#}\n    {%  for url in urls %}\n        <url>\n            <loc>{{ url.loc }}</loc>\n            <lastmod>{{ url.lastmod|date('c') }}</lastmod>\n            <changefreq>{{ url.changefreq }}</changefreq>\n            <priority>{{ url.priority }}</priority>\n        </url>\n    {% endfor %}\n\n</urlset>\n{% endblock %}\n\n{% block request %}\n    {% set paths = [] %}\n    {% for structure in emsch_search('structure', {\n        \"size\": 1000,\n        \"_source\": [\"paths.locale\",\"paths.target\",\"paths.path\"],\n    }).hits.hits|default([]) %}\n        {%  for path in structure._source.paths|default([])|filter(path => path.target|default(null) != null) %}\n            {%  set paths = paths|merge({(path.target): attribute(paths, path.target)|default([])|merge({ (path.locale): path }) }) %}\n        {%  endfor %}\n    {%  endfor %}\n\n    {% set urls = [] %}\n    {% for page in emsch_search('page', {\n        \"sort\": {\n            \"_finalization_datetime\": {\n                \"order\": \"desc\",\n                \"missing\": \"_last\",\n                \"unmapped_type\": \"long\"\n            }\n        },\n        \"size\": 1000,\n        \"_source\": [\"_finalization_datetime\"]|merge(locales|map(l => \"#{l}.title\"))|merge(locales|map(l => \"#{l}.slug\"))|merge(locales|map(l => \"#{l}.show\")),\n    }).hits.hits|default([]) %}\n        {%  for locale in locales %}\n            {% if attribute(page._source, locale).show|default(false) %}\n                {%  set loc = false %}\n                {% if attribute(paths, \"page:#{page._id}\") is defined and attribute(attribute(paths, \"page:#{page._id}\"), locale) is defined %}\n                    {%  set loc = url('emsch_path', {_locale: locale, path: attribute(attribute(paths, \"page:#{page._id}\"), locale).path}) %}\n                {% elseif attribute(page._source, locale).slug|default(false) and attribute(page._source, locale).slug == '/' %}\n                    {%  set loc = url('emsch_path', {_locale: locale}) %}\n                {% elseif attribute(page._source, locale).slug|default(false) %}\n                    {%  set loc = url('emsch_page', {_locale: locale, slug: attribute(page._source, locale).slug}) %}\n                {% endif %}\n                {%  if loc %}\n                    {% set urls = urls|merge([{\n                        loc: loc,\n                        changefreq: 'weekly',\n                        priority: 0.7,\n                        lastmod: page._source._finalization_datetime|default('now'),\n                    }]) %}\n                {% endif %}\n            {% endif %}\n        {% endfor %}\n    {% endfor %}\n    {{ block('dom') }}\n{% endblock -%}\n",
    "name": "seo/sitemap.xml.twig"
}