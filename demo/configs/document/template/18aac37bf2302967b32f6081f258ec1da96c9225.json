{
    "body": "{% extends '@EMSCH/template/accessibility/abstract.html.twig' %}\n{% trans_default_domain trans_default_domain %}\n\n{% block rule_table %}\n    <div class=\"table-responsive\">\n        <table class=\"table table-hover\">\n            <thead>\n            <tr>\n                <th scope=\"col\" style=\"width: 65%\">{{ 'accessibility.description'|trans }}</th>\n                <th scope=\"col\">{{ 'accessibility.pages'|trans }}</th>\n                <th scope=\"col\">{{ 'accessibility.errors'|trans }}</th>\n                <th scope=\"col\">{{ 'accessibility.references'|trans }}</th>\n            </tr>\n            </thead>\n            <tbody>\n            {% for issue in subrule %}\n                <tr>\n                    <td>\n                        {% if issue.labels|length > 1 %}\n                            <ul>\n                                {% for label in issue.labels %}\n                                    <li>{{ \"accessibility.labels.#{subruleKey}.#{label}\"|trans }}</li>\n                                {% endfor %}\n                            </ul>\n                        {% else %}\n                            {{ \"accessibility.labels.#{subruleKey}.#{issue.labels|first}\"|trans }}\n                        {% endif %}\n                    </td>\n                    {% set key = attribute(data, issue.references|default([])|map((k, d) => d)|join(',')).key|default(null) %}\n                    <td>\n                        {% if key and (app.request.server.all['EMSCO_INSTANCE_ID']|default(false) or app.environment == 'dev') %}\n                            <a href=\"{{ path('emsch_accessibility_detail', {key: key}) }}\">{{  attribute(data, issue.references|default([])|map((k, d) => d)|join(',')).pages|default(0) }}</a>\n                        {%  elseif key %}\n                            {{  attribute(data, issue.references|default([])|map((k, d) => d)|join(',')).pages|default(0) }}\n                        {%  else %}\n                            0\n                        {%  endif %}\n                    </td>\n                    <td>\n                        {% if key and (app.request.server.all['EMSCO_INSTANCE_ID']|default(false) or app.environment == 'dev') %}\n                            <a href=\"{{ path('emsch_accessibility_detail', {key: key}) }}\">{{  attribute(data, issue.references|default([])|map((k, d) => d)|join(',')).errors|default(0) }}</a>\n                        {%  elseif key %}\n                            {{  attribute(data, issue.references|default([])|map((k, d) => d)|join(',')).errors|default(0) }}\n                        {%  else %}\n                            0\n                        {%  endif %}\n                    </td>\n                    <td>\n                        {% for k,link in issue.references %}\n\n                            {% if (app.request.server.all['EMSCO_INSTANCE_ID']|default(false) or app.environment == 'dev') %}\n                                <a target=\"_blank\" href=\"{{ link }}\" class=\"ext\" data-extlink=\"\">{{ k }}</a>\n                            {% else %}\n                                {{ k }}\n                            {% endif %}\n                        {% endfor %}\n                    </td>\n                </tr>\n            {% endfor %}\n            </tbody>\n        </table>\n    </div>\n{% endblock %}\n\n{% block request %}\n    {% set audit = (emsch_search('audit', {\n        \"size\": 1,\n        \"query\": {\n            \"range\": {\n                \"status_code\": {\n                    \"gte\": 200,\n                    \"lt\": 300\n                }\n            }\n        },\n        \"sort\":  [{'timestamp': 'asc'}],\n        \"aggs\": {\n            \"pa11y\": {\n                \"nested\": {\n                    \"path\": \"pa11y\"\n                },\n                \"aggs\": {\n                    \"codes\": {\n                        \"terms\": {\n                            \"size\": 1000,\n                            \"field\": \"pa11y.code\"\n                        },\n                        \"aggs\": {\n                            \"code_to_docs\": {\n                                \"reverse_nested\": {},\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    })) %}\n\n    {%  set data = audit.aggregations.pa11y.codes.buckets|default([])|map(d => {\n        id: d.key|split('.')[4],\n        key: d.key,\n        errors: d.doc_count,\n        pages: d.code_to_docs.doc_count,\n    })|array_key('id') %}\n\n    <div id=\"general-info\">\n        <h2>{{ 'accessibility.general_info'|trans }}</h2>\n        <dl class=\"row\">\n            <dt class=\"col-sm-4\">{{ 'accessibility.website_url'|trans }}</dt><dd class=\"col-sm-8\">{{ app.request.getSchemeAndHttpHost() }}</dd>\n            <dt class=\"col-sm-4\">{{ 'accessibility.audit_date'|trans }}</dt><dd class=\"col-sm-8\">{{ audit.hits.hits[0]._source.timestamp|default('now')|date(\"d-m-Y\") }}</dd>\n            <dt class=\"col-sm-4\">{{ \"accessibility.amount_page_scanned\"|trans }}</dt><dd class=\"col-sm-8\">{{ audit.hits.total.value|default(0) }}</dd>\n        </dl>\n    </div>\n    <div id=\"audit\">\n        <h2>{{ 'accessibility.accessibility_audit'|trans }}</h2>\n        {% for rule in pageStructure %}\n            <h3>{{ \"accessibility.labels.#{loop.index}\"|trans }}</h3>\n            <p>{{ \"accessibility.info_texts.#{loop.index}\"|trans }}</p>\n            {% for childKey, child in rule %}\n                <h4>{{ \"accessibility.labels.#{childKey}\"|trans }}</h4>\n                <p>{{ \"accessibility.info_texts.#{childKey}\"|trans }}</p>\n                {% for subruleKey, subrule in child %}\n                    <h5>{{ \"accessibility.labels.#{subruleKey}\"|trans }}</h5>\n                    {{ block('rule_table') }}\n                {% endfor %}\n            {% endfor %}\n        {% endfor %}\n    </div>\n{% endblock request %}\n",
    "name": "accessibility/report.html.twig"
}